<!doctype html><html lang=en dir=auto><script src=/js/external-links.js></script><head><meta charset=utf-8><meta http-equiv=Cache-Control content="max-age=259200"><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Brute Forcing Pandoc with Panflute | justin.vc</title>
<meta name=keywords content="tiddlywiki,pandoc,panflute"><meta name=description content="Hello! This is a short post, more of a &ldquo;here&rsquo;s an intersting thing I wandered into&rdquo; type of post. I originally wrote most of my posts on TiddlyWiki, which is where https://www.zk.justin.vc resides now. I decided to move this site to Hugo and was pondering: &ldquo;Could I write all my notes in org-mode, and convert them?&rdquo;
I remembered pandoc and how simple it was to convert various LaTeX and markdown files back and forth."><meta name=author content="Justin"><link rel=canonical href=https://justin.vc/posts/brute-forcing-pandoc-with-panflute/><link crossorigin=anonymous href=/assets/css/stylesheet.min.7d5e839402b7760e17d812f67ef54931e483fcc8ceb80b5f8a1542d97193a6f9.css integrity="sha256-fV6DlAK3dg4X2BL2fvVJMeSD/MjOuAtfihVC2XGTpvk=" rel="preload stylesheet" as=style><link rel=icon href=https://justin.vc/earthbound-globe.png><link rel=apple-touch-icon href=https://justin.vc/apple-touch-icon.png><link rel=alternate hreflang=en href=https://justin.vc/posts/brute-forcing-pandoc-with-panflute/><meta name=twitter:image content="https://justin.vc/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:card property="twitter:card" content="summary"><meta name=twitter:title content="Brute Forcing Pandoc with Panflute | justin.vc"><meta name=twitter:description content="Hello! This is a short post, more of a &ldquo;here&rsquo;s an intersting thing I wandered into&rdquo; type of post. I originally wrote most of my posts on TiddlyWiki, which is where https://www.zk.justin.vc resides now. I decided to move this site to Hugo and was pondering: &ldquo;Could I write all my notes in org-mode, and convert them?&rdquo;
I remembered pandoc and how simple it was to convert various LaTeX and markdown files back and forth."><meta name=twitter:site content><meta name=twitter:creator content><meta property="og:title" content="Brute Forcing Pandoc with Panflute | justin.vc"><meta property="og:description" content="Hello! This is a short post, more of a &ldquo;here&rsquo;s an intersting thing I wandered into&rdquo; type of post. I originally wrote most of my posts on TiddlyWiki, which is where https://www.zk.justin.vc resides now. I decided to move this site to Hugo and was pondering: &ldquo;Could I write all my notes in org-mode, and convert them?&rdquo;
I remembered pandoc and how simple it was to convert various LaTeX and markdown files back and forth."><meta property="og:type" content="article"><meta property="og:url" content="https://justin.vc/posts/brute-forcing-pandoc-with-panflute/"><meta property="og:image" content="https://justin.vc/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-08-08T15:30:00-04:00"><meta property="article:modified_time" content="2022-08-08T16:28:51-04:00"><meta property="og:site_name" content="justin.vc"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://justin.vc/posts/"},{"@type":"ListItem","position":2,"name":"Brute Forcing Pandoc with Panflute","item":"https://justin.vc/posts/brute-forcing-pandoc-with-panflute/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Brute Forcing Pandoc with Panflute | justin.vc","name":"Brute Forcing Pandoc with Panflute","description":"Hello! This is a short post, more of a \u0026ldquo;here\u0026rsquo;s an intersting thing I wandered into\u0026rdquo; type of post. I originally wrote most of my posts on TiddlyWiki, which is where https://www.zk.justin.vc resides now. I decided to move this site to Hugo and was pondering: \u0026ldquo;Could I write all my notes in org-mode, and convert them?\u0026rdquo;\nI remembered pandoc and how simple it was to convert various LaTeX and markdown files back and forth.","keywords":["tiddlywiki","pandoc","panflute"],"wordCount":"1324","inLanguage":"en","datePublished":"2022-08-08T15:30:00-04:00","dateModified":"2022-08-08T16:28:51-04:00","author":[{"@type":"Person","name":"Justin"}],"mainEntityOfPage":{"@type":"WebPage","@id":"https://justin.vc/posts/brute-forcing-pandoc-with-panflute/"},"publisher":{"@type":"Organization","name":"justin.vc","logo":{"@type":"ImageObject","url":"https://justin.vc/earthbound-globe.png"}}}</script><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript></head><body class=dark id=top><style>body{visibility:visible}</style><script>const storageKey="pref-theme",onClick=()=>{const e=isDarkTheme();setPrefTheme(e?"light":"dark")},isDarkTheme=()=>document.body.classList.contains("dark"),getPrefTheme=()=>{const e=localStorage.getItem(storageKey);return e?e:window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"},setPrefTheme=e=>{localStorage.setItem(storageKey,e),reflectPreference(e)},reflectPreference=e=>{e==="dark"?(document.body.classList.add("dark"),document.firstElementChild.setAttribute("data-theme","dark")):(document.body.classList.remove("dark"),document.firstElementChild.setAttribute("data-theme","light")),setTimeout(()=>{document.body.classList.add("theme-loaded")},50)};(function(){const e=getPrefTheme();reflectPreference(e)})(),document.addEventListener("DOMContentLoaded",function(){document.querySelector("#theme-toggle").addEventListener("click",onClick),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",({matches:e})=>{setPrefTheme(e?"dark":"light")}),window.addEventListener("toggle-theme",function(){onClick()})})</script><div class=right-container><div class=right-box><a href=/ title="Travel to home page"><svg width="20" height="20" stroke="currentcolor" fill="currentcolor" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg"><path d="M31.772 16.043l-15.012-15.724c-.189-.197-.449-.307-.721-.307s-.533.111-.722.307l-15.089 15.724c-.383.398-.369 1.031.029 1.414.399.382 1.031.371 1.414-.029l1.344-1.401V30.99c0 .552.448 1 1 1h6.986c.551.0.998-.445 1-.997l.031-9.989h7.969v9.986c0 .552.448 1 1 1h6.983c.552.0 1-.448 1-1V16.022l1.343 1.407c.197.204.459.308.722.308.249.0.499-.092.692-.279.398-.382.411-1.015.029-1.413zm-4.787-1.83v15.776h-4.983v-9.986c0-.552-.448-1-1-1h-9.965c-.551.0-.998.445-1 .997l-.031 9.989H5.017V14.212c0-.082-.013-.162-.032-.239L16.04 2.453 27.022 13.96c-.021.081-.036.165-.036.252z"/></svg>
</a><a href=/search title="Travel to /search page"><svg height="20" width="20" id="_x32_" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 512 512" stroke="currentcolor" fill="currentcolor"><g><path class="st0" d="M312.069 53.445c-71.26-71.26-187.194-71.26-258.454.0-71.261 71.26-71.261 187.206.0 258.466 71.26 71.26 187.194 71.26 258.454.0s71.26-187.206.0-258.466zM286.694 286.536c-57.351 57.34-150.353 57.34-207.704-.011s-57.351-150.353.0-207.693c57.351-57.351 150.342-57.351 207.693.0S344.045 229.174 286.694 286.536z"/><path class="st0" d="M101.911 112.531c-29.357 37.725-31.801 89.631-7.321 129.702 1.877 3.087 5.902 4.048 8.978 2.182 3.065-1.888 4.037-5.903 2.16-8.978-21.666-35.456-19.506-81.538 6.469-114.876 2.226-2.837 1.713-6.938-1.135-9.154C108.227 109.193 104.125 109.695 101.911 112.531z"/><path class="st0" d="M498.544 447.722l-132.637-129.2c-7.255-7.07-18.84-6.982-26.008.174l-21.033 21.033c-7.156 7.156-7.234 18.742-.153 25.986l129.19 132.636c14.346 17.324 35.542 18.35 51.917 1.964C516.216 483.951 515.857 462.068 498.544 447.722z"/></g></svg></a></div><div class=right-box><button class=theme-toggle id=theme-toggle title="Toggles light & dark" aria-label=auto aria-live=polite><svg class="sun-and-moon" aria-hidden="true" width="24" height="24" viewBox="0 0 24 24"><mask class="moon" id="moon-mask"><rect x="0" y="0" width="100%" height="100%" fill="#fff"/><circle cx="24" cy="10" r="6" fill="#000"/></mask><circle class="sun" cx="12" cy="12" r="6" mask="url(#moon-mask)" fill="currentcolor"/><g class="sun-beams" stroke="currentcolor"><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></g></svg></button></div><div class=right-box><button id=toggle-reader-on title="toggle 'reader mode' on - hiding unncessary elements and expanding width of body. Works on post pages only.">
<svg height="20" width="20" stroke="currentcolor" fill="currentcolor" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 472.615 472.615"><g><g><path d="M246.153 55.558v402.885c74.135-34.307 152.741-47.774 226.463-38.569.0-134.295.0-268.589.0-402.884C398.896 7.786 320.289 21.252 246.153 55.558z"/></g></g><g><g><path d="M.001 16.99C0 151.285.0 285.579.001 419.874c73.719-9.204 152.325 4.262 226.46 38.568V55.557C152.324 21.252 73.719 7.786.001 16.99z"/></g></g></svg>
</button>
<button id=toggle-reader-off class=toggled title="toggle 'reader mode' off - this is the default site experience"><svg height="20" width="20" stroke="currentcolor" fill="currentcolor" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 492.308 492.308"><g><g><path d="M483.683 14.104c-77.81-9.724-159.79 4.885-237.529 42.096C168.418 18.988 86.412 4.409 8.625 14.104L0 15.181v422.731l11.067-1.385c75.327-9.413 155.072 5.183 230.519 42.154l1.237.603 3.018 1.791.325-.159.444.216 3.227-2.014.811-.399c75.519-37.019 155.236-51.587 230.591-42.192l11.067 1.385V15.181L483.683 14.104zM236.308 454.431c-59.058-26.692-120.351-40.375-180.202-40.375-12.207.0-24.361.567-36.413 1.712V32.671c70.966-7.077 145.577 6.856 216.615 40.587V454.431zm236.307-38.664c-71.048-6.683-145.346 6.51-216.615 38.683V73.257c71.038-33.731 145.611-47.683 216.615-40.587V415.767z"/></g></g></svg></button></div></div><script>const topRightDiv=document.querySelector(".right-container");function handleScroll(){window.scrollY>150?topRightDiv.classList.add("fade-out"):topRightDiv.classList.remove("fade-out")}window.addEventListener("scroll",handleScroll),document.addEventListener("DOMContentLoaded",()=>{const t=document.getElementById("toggle-reader-on"),e=document.getElementById("toggle-reader-off"),n=document.querySelector("main"),s=document.querySelector(".main.post"),o=document.querySelector(".post-single"),i=document.querySelector(".toc.side"),a=document.querySelector(".header"),r=localStorage.getItem("readerMode");e.disabled=!0,r==="enabled"?(n&&n.classList.add("reduced-padding"),s&&s.classList.add("full-width"),o&&o.classList.add("margin-expanded"),i&&i.classList.toggle("side"),a.classList.toggle("hidden"),t.classList.add("toggled"),t.disabled=!0,e.classList.remove("toggled"),e.disabled=!1,localStorage.setItem("readerMode","enabled")):e.disabled=!0,t.addEventListener("click",()=>{n&&n.classList.add("reduced-padding"),s&&s.classList.add("full-width"),o&&o.classList.add("margin-expanded"),i&&i.classList.toggle("side"),a.classList.toggle("hidden"),localStorage.setItem("readerMode","enabled"),t.classList.add("toggled"),t.disabled=!0,e.classList.remove("toggled"),e.disabled=!1}),e.addEventListener("click",()=>{n&&n.classList.remove("reduced-padding"),s&&s.classList.remove("full-width"),o&&o.classList.remove("margin-expanded"),i&&i.classList.toggle("side"),a.classList.toggle("hidden"),localStorage.setItem("readerMode","disabled"),e.classList.add("toggled"),e.disabled=!0,t.classList.remove("toggled"),t.disabled=!1})})</script><header class=header><nav class=nav><div class=ascii-art id=ascii1 style=display:none><i class="fas fa-palette"></i>
<a href=/><pre>
          ▄▄▄▄▄      ▄     ▄▄▄▄▄      ▄▄▄▄▀ ▄█    ▄          ▄   ▄█▄    
         ▄▀  █       █    █     ▀▄ ▀▀▀ █    ██     █          █  █▀ ▀▄  
             █    █   █ ▄  ▀▀▀▀▄       █    ██ ██   █    █     █ █   ▀  
           ▄ █    █   █  ▀▄▄▄▄▀       █     ▐█ █ █  █     █    █ █▄  ▄▀ 
            ▀     █▄ ▄█              ▀       ▐ █  █ █ <a class=color>██</a><a href=/>   █  █  ▀███▀  
                   ▀▀▀                         █   ██       █▐                     
            </pre></a></div><div class=ascii-art id=ascii12 style=display:none><i class="fas fa-palette"></i>
<a href=/><pre>      
        ██╗██╗   ██╗███████╗████████╗██╗███╗   ██╗   ██╗   ██╗ ██████╗
        ██║██║   ██║██╔════╝╚══██╔══╝██║████╗  ██║   ██║   ██║██╔════╝
        ██║██║   ██║███████╗   ██║   ██║██╔██╗ ██║   ██║   ██║██║     
   ██   ██║██║   ██║╚════██║   ██║   ██║██║╚██╗██║   ╚██╗ ██╔╝██║     
   ╚█████╔╝╚██████╔╝███████║   ██║   ██║██║ ╚████║<a class=color href=/>██╗</a><a href=/> ╚████╔╝ ╚██████╗
    ╚════╝  ╚═════╝ ╚══════╝   ╚═╝   ╚═╝╚═╝  ╚═══╝╚═╝  ╚═══╝   ╚═════╝</pre></div><div class=ascii-art id=ascii13 style=display:none><i class="fas fa-palette"></i>
<a href=/><pre class=threed>
     ___      ___  ___     ________     _________    ___      ________          ___      ___  ________     
    |\  \    |\  \|\  \   |\   ____\   |\___   ___\ |\  \    |\   ___  \       |\  \    /  /||\   ____\    
    \ \  \   \ \  \\\  \  \ \  \___|_  \|___ \  \_| \ \  \   \ \  \\ \  \      \ \  \  /  / /\ \  \___|    
  __ \ \  \   \ \  \\\  \  \ \_____  \      \ \  \   \ \  \   \ \  \\ \  \      \ \  \/  / /  \ \  \       
 |\  \\_\  \   \ \  \\\  \  \|____|\  \      \ \  \   \ \  \   \ \  \\ \  \  <a class=color href=/>___</a><a href=/> \ \    / /    \ \  \____  
 \ \________\   \ \_______\   ____\_\  \      \ \__\   \ \__\   \ \__\\ \__\<a class=color href=/>|\__\</a><a href=/> \ \__/ /      \ \_______\
  \|________|    \|_______|  |\_________\      \|__|    \|__|    \|__| \|__|<a class=color href=/>\|__|</a><a href=/>  \|__|/        \|_______|</pre></div><div class=ascii-art id=ascii14 style=display:none><i class="fas fa-palette"></i>
<a href=/><pre class=smoll-ascii>
    (_)_   _ ___| |_(_)_ __ __   _____ 
    | | | | / __| __| | '_ \\ \ / / __|
    | | |_| \__ \ |_| | | | |\ V / (__ 
   _/ |\__,_|___/\__|_|_| |_<a class=color href=/>(_)</a>_/ \___|
   |__/</pre></a></div><ul id=menu><li><a href=https://justin.vc/about/ title=About>About</a></li><li><a href=https://justin.vc/now/ title=Now>Now</a></li><li><a href=https://notes.justin.vc/ title=Notes>Notes</a></li><li><a href=https://justin.vc/elfeed/ title=Links>Links</a></li></ul></nav></header><style>div.ascii-art{display:flex;align-items:center;justify-content:center}.color{color:var(--link-header-color)}header pre{font-size:6px;font-family:courier new,Courier,monospace;line-height:1;margin:0}.threed{font-size:5px}.smoll-ascii{font-size:8px}@media(max-width:630px){header pre{font-size:5px;line-height:1}.threed{font-size:3px}#menu a{padding:0;margin:0}}</style><script>document.addEventListener("DOMContentLoaded",function(){var e=document.querySelectorAll(".ascii-art"),t=Math.floor(Math.random()*e.length);e[t].style.display="block"})</script><main class="main post"><article class=post-single><div class=breadcrumbs><a href=https://justin.vc/>Home</a>&nbsp;»&nbsp;<a href=https://justin.vc/posts/>Posts</a></div><h1 class=post-title>Brute Forcing Pandoc with Panflute</h1><div class=post-meta><span class=meta-item><span class=post-date>&#160;2022/08/08&#160;
<b><a href=https://github.com/brickfrog/justin.vc/commits/master/content/posts/brute-forcing-pandoc-with-panflute.md>⟹</a></b>
&#160;<u><a href=https://raw.githubusercontent.com/brickfrog/justin.vc/master/content/posts/brute-forcing-pandoc-with-panflute.md>2022/08/08</a></u>
</span></span><span class=meta-item><span class=post-tags>&#160;<a href=https://justin.vc/tags/tiddlywiki/>Tiddlywiki</a><a href=https://justin.vc/tags/pandoc/>Pandoc</a><a href=https://justin.vc/tags/panflute/>Panflute</a></span></span></div><div class=dingbat>🙞</div><div class=post-content><p>Hello! This is a short post, more of a &ldquo;here&rsquo;s an intersting thing I wandered
into&rdquo; type of post. I originally wrote most of my posts on TiddlyWiki, which is
where <a href=https://www.zk.justin.vc>https://www.zk.justin.vc</a> resides now. I decided to move this site to Hugo
and was pondering: &ldquo;Could I write all my notes in org-mode, and convert them?&rdquo;</p><p>I remembered <a href=https://pandoc.org>pandoc</a> and how simple it was to convert various LaTeX and markdown
files back and forth. The problem was, there&rsquo;s no converter for TiddlyWiki due
to its dynamism. I found a couple Python2 githubs but they seemed a bit out of
date. So I took it on myself to figure out how pandoc filters worked.</p><p>I didn&rsquo;t want to spend -too- much time, so writing Haskell and Lua filters were
out. I&rsquo;d probably seriously consider Lua next time just cause it seems to be a
language that is on the up-and-up, but that&rsquo;s neither here nor there.</p><p>Enter <a href=https://github.com/sergiocorreia/panflute>panflute</a>, a pythonic way to write pandoc filters.It&rsquo;s relatively old, but
I didn&rsquo;t have any issues, even on the newest version of pandoc that was released
just a couple days ago (August &lsquo;22).</p><p>Essentially you operate on the normal pandoc portions of the AST such as Para /
Header / Strings, and use a filter to change them. My use case was kind of weird
where I wanted to edit the text wholecloth in some cases.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=org-coderef--e1bcfb-1><a class=lnlinks href=#org-coderef--e1bcfb-1> 1</a>
</span><span class=lnt id=org-coderef--e1bcfb-2><a class=lnlinks href=#org-coderef--e1bcfb-2> 2</a>
</span><span class=lnt id=org-coderef--e1bcfb-3><a class=lnlinks href=#org-coderef--e1bcfb-3> 3</a>
</span><span class=lnt id=org-coderef--e1bcfb-4><a class=lnlinks href=#org-coderef--e1bcfb-4> 4</a>
</span><span class=lnt id=org-coderef--e1bcfb-5><a class=lnlinks href=#org-coderef--e1bcfb-5> 5</a>
</span><span class=lnt id=org-coderef--e1bcfb-6><a class=lnlinks href=#org-coderef--e1bcfb-6> 6</a>
</span><span class=lnt id=org-coderef--e1bcfb-7><a class=lnlinks href=#org-coderef--e1bcfb-7> 7</a>
</span><span class=lnt id=org-coderef--e1bcfb-8><a class=lnlinks href=#org-coderef--e1bcfb-8> 8</a>
</span><span class=lnt id=org-coderef--e1bcfb-9><a class=lnlinks href=#org-coderef--e1bcfb-9> 9</a>
</span><span class=lnt id=org-coderef--e1bcfb-10><a class=lnlinks href=#org-coderef--e1bcfb-10>10</a>
</span><span class=lnt id=org-coderef--e1bcfb-11><a class=lnlinks href=#org-coderef--e1bcfb-11>11</a>
</span><span class=lnt id=org-coderef--e1bcfb-12><a class=lnlinks href=#org-coderef--e1bcfb-12>12</a>
</span><span class=lnt id=org-coderef--e1bcfb-13><a class=lnlinks href=#org-coderef--e1bcfb-13>13</a>
</span><span class=lnt id=org-coderef--e1bcfb-14><a class=lnlinks href=#org-coderef--e1bcfb-14>14</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>panflute</span> <span class=kn>import</span> <span class=o>*</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>increase_header_level</span><span class=p>(</span><span class=n>elem</span><span class=p>,</span> <span class=n>doc</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nb>type</span><span class=p>(</span><span class=n>elem</span><span class=p>)</span> <span class=o>==</span> <span class=n>Header</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>elem</span><span class=o>.</span><span class=n>level</span> <span class=o>&lt;</span> <span class=mi>6</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>elem</span><span class=o>.</span><span class=n>level</span> <span class=o>+=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=p>[]</span> <span class=c1>#                                    (delete action)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>main</span><span class=p>(</span><span class=n>doc</span><span class=o>=</span><span class=kc>None</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>run_filter</span><span class=p>(</span><span class=n>increase_header_level</span><span class=p>,</span> <span class=n>doc</span><span class=o>=</span><span class=n>doc</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&#34;__main__&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>main</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><p>As you can see in the example, it&rsquo;s pretty self-intuitive when you&rsquo;re doing
simple things. This simply looks at each element to see if there&rsquo;s a &ldquo;header&rdquo;,
and adds a level if it&rsquo;s below level 6. If they&rsquo;re level 6, then it deletes them.</p><p>I probably could&rsquo;ve just used normal bash tools but I wanted to do everything in
one script. This article will be more of a code-dump with my thought process. I don&rsquo;t
promise it will be pretty but I figured I didn&rsquo;t see many other people doing
this so it&rsquo;s not -completely- useless.</p><p>So, text for tiddlywiki tends to be something like this:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>title: testing test
</span></span><span class=line><span class=cl>type: text/vnd.tiddlywiki
</span></span><span class=line><span class=cl>tags: programming org
</span></span><span class=line><span class=cl>created: 20220805
</span></span><span class=line><span class=cl>modified: 20220808
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>! Summary
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>This is a test article for pandoc and figure out all the associated classes. [[flow state]] is neat. Beep. Beep.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> * This
</span></span><span class=line><span class=cl> * is
</span></span><span class=line><span class=cl> * a
</span></span><span class=line><span class=cl>  * nested
</span></span><span class=line><span class=cl>  * list
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>!! Other
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Also some other stuff, I guess. Woop. A link to something such as [[julia
</span></span><span class=line><span class=cl>programming language]]
</span></span></code></pre></div><p>With all the metadata at the top, which was the key difficulty. The second was
that org-roam primarily uses its ids to link. This I can&rsquo;t take the credit for,
I borrowed code from: <a href=https://www.amoradi.org/20210730173543.html>https://www.amoradi.org/20210730173543.html</a>.</p><p>The converter for MediaWiki gets you almost all of the way there, excluding the
metadata. It, thankfully, uses the &lsquo;same <code>[[ ]]</code> syntax for links that TiddlyWiki
does.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>sqlite3</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>os</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>panflute</span> <span class=kn>import</span> <span class=o>*</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>ORG_ROAM_DB_PATH</span> <span class=o>=</span> <span class=s2>&#34;/home/justin/.org/brain/org-roam.db&#34;</span>
</span></span></code></pre></div><p>The constant for the org-roam db is necessary since I use org-roam, otherwise
unneeded. This only requires panflute as a third party library.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>prepare</span><span class=p>(</span><span class=n>doc</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=c1># Gets the title of the document and instantiates the list for appending</span>
</span></span><span class=line><span class=cl>    <span class=n>doc</span><span class=o>.</span><span class=n>header</span> <span class=o>=</span> <span class=p>[</span><span class=sa>f</span><span class=s2>&#34;title: </span><span class=si>{</span><span class=n>stringify</span><span class=p>(</span><span class=n>doc</span><span class=o>.</span><span class=n>metadata</span><span class=p>[</span><span class=s1>&#39;title&#39;</span><span class=p>])</span><span class=si>}</span><span class=se>\n</span><span class=s2>type: text/vnd.tiddlywiki</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>]</span>
</span></span></code></pre></div><p>This is where you can set up global variables in the document. I use this to
store text in lists and as the initial part of the metadata, getting the header.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>sanitize_link</span><span class=p>(</span><span class=n>elem</span><span class=p>,</span> <span class=n>doc</span><span class=p>):</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;&#39;&#39;
</span></span></span><span class=line><span class=cl><span class=s1>    Reformats the links so they work in TiddlyWiki, MediaWiki naturally
</span></span></span><span class=line><span class=cl><span class=s1>    uses the [[]] syntax so this just does a lookup against the org-roam id
</span></span></span><span class=line><span class=cl><span class=s1>    and replace it with the title.
</span></span></span><span class=line><span class=cl><span class=s1>    &#39;&#39;&#39;</span>
</span></span><span class=line><span class=cl>    <span class=n>file_id</span> <span class=o>=</span> <span class=n>elem</span><span class=o>.</span><span class=n>url</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s2>&#34;:&#34;</span><span class=p>)[</span><span class=mi>1</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>cur</span> <span class=o>=</span> <span class=n>db</span><span class=o>.</span><span class=n>cursor</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>cur</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;select id, file, title from nodes where id = &#39;</span><span class=se>\&#34;</span><span class=si>{</span><span class=n>file_id</span><span class=si>}</span><span class=se>\&#34;</span><span class=s2>&#39;;&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>data</span> <span class=o>=</span> <span class=n>cur</span><span class=o>.</span><span class=n>fetchone</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>file_id</span> <span class=o>=</span> <span class=n>data</span><span class=p>[</span><span class=mi>0</span><span class=p>][</span><span class=mi>1</span><span class=p>:</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>file_name</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>data</span><span class=p>[</span><span class=mi>2</span><span class=p>][</span><span class=mi>1</span><span class=p>:</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>elem</span><span class=o>.</span><span class=n>url</span> <span class=o>=</span> <span class=n>file_name</span>
</span></span></code></pre></div><p>As mentioned above, I did borrow the code for this section, and modified it to
my needs (the original author exported to HTML directly). It looks up the
org-roam id: and replaces it with the title, since that&rsquo;s how I store my files
on my zettelkasten.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>metadata_parser</span><span class=p>(</span><span class=n>elem</span><span class=p>,</span> <span class=n>doc</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;&#39;&#39;
</span></span></span><span class=line><span class=cl><span class=s1>    Parses the input element content to format it in
</span></span></span><span class=line><span class=cl><span class=s1>    a way that (my) TiddlyWiki understands.
</span></span></span><span class=line><span class=cl><span class=s1>
</span></span></span><span class=line><span class=cl><span class=s1>    TODO: needs refactoring if it gets more complex
</span></span></span><span class=line><span class=cl><span class=s1>    &#39;&#39;&#39;</span>
</span></span><span class=line><span class=cl>    <span class=n>block</span> <span class=o>=</span> <span class=n>elem</span><span class=o>.</span><span class=n>text</span><span class=o>.</span><span class=n>split</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># transforming filetags -&gt; tags:</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>elem</span><span class=o>.</span><span class=n>text</span><span class=o>.</span><span class=n>startswith</span><span class=p>(</span><span class=s1>&#39;#+filetags&#39;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>text</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>block</span><span class=p>[</span><span class=mi>0</span><span class=p>][</span><span class=mi>6</span><span class=p>:]</span><span class=si>}</span><span class=s2> </span><span class=si>{</span><span class=n>block</span><span class=p>[</span><span class=mi>1</span><span class=p>][</span><span class=mi>1</span><span class=p>:</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=s1>&#39;:&#39;</span><span class=p>,</span><span class=s1>&#39; &#39;</span><span class=p>)</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>    <span class=c1># transforming created to: created, and format of YYYYMMDD</span>
</span></span><span class=line><span class=cl>    <span class=k>elif</span> <span class=n>elem</span><span class=o>.</span><span class=n>text</span><span class=o>.</span><span class=n>startswith</span><span class=p>(</span><span class=s1>&#39;#+created&#39;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>text</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>block</span><span class=p>[</span><span class=mi>0</span><span class=p>][</span><span class=mi>2</span><span class=p>:]</span><span class=si>}</span><span class=s2> </span><span class=si>{</span><span class=n>block</span><span class=p>[</span><span class=mi>1</span><span class=p>][</span><span class=mi>1</span><span class=p>:]</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=s1>&#39;-&#39;</span><span class=p>,</span><span class=s1>&#39;&#39;</span><span class=p>)</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>    <span class=c1># transforming last_modified to modified, and format of YYYYMMDD</span>
</span></span><span class=line><span class=cl>    <span class=k>elif</span> <span class=n>elem</span><span class=o>.</span><span class=n>text</span><span class=o>.</span><span class=n>startswith</span><span class=p>(</span><span class=s1>&#39;#+last_modified&#39;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>text</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>block</span><span class=p>[</span><span class=mi>0</span><span class=p>][</span><span class=o>-</span><span class=mi>9</span><span class=p>:]</span><span class=si>}</span><span class=s2> </span><span class=si>{</span><span class=n>block</span><span class=p>[</span><span class=mi>1</span><span class=p>][</span><span class=mi>1</span><span class=p>:]</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=s1>&#39;-&#39;</span><span class=p>,</span><span class=s1>&#39;&#39;</span><span class=p>)</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>text</span> <span class=o>+</span> <span class=s1>&#39;</span><span class=se>\n</span><span class=s1>&#39;</span>
</span></span></code></pre></div><p>This is where things get a bit hairy, I essentially use this to parse the
associated RawBlock for org and return them as vanilla strings. All TiddlyWiki
tiddlers use this metadata. Eventually I&rsquo;d like to add more, things like
reading status and private/public depending on the underlying file. While I&rsquo;m
pretty sure this is not a good way to do it, it works.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>header_parser</span><span class=p>(</span><span class=n>elem</span><span class=p>,</span> <span class=n>doc</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;&#39;&#39;
</span></span></span><span class=line><span class=cl><span class=s1>    TiddlyWiki uses !&#39;s for headers
</span></span></span><span class=line><span class=cl><span class=s1>    &#39;&#39;&#39;</span>
</span></span><span class=line><span class=cl>    <span class=n>s</span> <span class=o>=</span> <span class=s1>&#39;&#39;</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>n</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=mi>4</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>elem</span><span class=o>.</span><span class=n>level</span> <span class=o>==</span> <span class=n>n</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>s</span> <span class=o>=</span> <span class=s1>&#39;!&#39;</span> <span class=o>*</span> <span class=n>n</span> <span class=o>+</span> <span class=s1>&#39; &#39;</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>s</span>
</span></span></code></pre></div><p>Prepending !&rsquo;s to MediaWiki headers, since TiddlyWiki uses ! while MediaWiki
uses =&rsquo;s.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=org-coderef--8846f0-1><a class=lnlinks href=#org-coderef--8846f0-1> 1</a>
</span><span class=lnt id=org-coderef--8846f0-2><a class=lnlinks href=#org-coderef--8846f0-2> 2</a>
</span><span class=lnt id=org-coderef--8846f0-3><a class=lnlinks href=#org-coderef--8846f0-3> 3</a>
</span><span class=lnt id=org-coderef--8846f0-4><a class=lnlinks href=#org-coderef--8846f0-4> 4</a>
</span><span class=lnt id=org-coderef--8846f0-5><a class=lnlinks href=#org-coderef--8846f0-5> 5</a>
</span><span class=lnt id=org-coderef--8846f0-6><a class=lnlinks href=#org-coderef--8846f0-6> 6</a>
</span><span class=lnt id=org-coderef--8846f0-7><a class=lnlinks href=#org-coderef--8846f0-7> 7</a>
</span><span class=lnt id=org-coderef--8846f0-8><a class=lnlinks href=#org-coderef--8846f0-8> 8</a>
</span><span class=lnt id=org-coderef--8846f0-9><a class=lnlinks href=#org-coderef--8846f0-9> 9</a>
</span><span class=lnt id=org-coderef--8846f0-10><a class=lnlinks href=#org-coderef--8846f0-10>10</a>
</span><span class=lnt id=org-coderef--8846f0-11><a class=lnlinks href=#org-coderef--8846f0-11>11</a>
</span><span class=lnt id=org-coderef--8846f0-12><a class=lnlinks href=#org-coderef--8846f0-12>12</a>
</span><span class=lnt id=org-coderef--8846f0-13><a class=lnlinks href=#org-coderef--8846f0-13>13</a>
</span><span class=lnt id=org-coderef--8846f0-14><a class=lnlinks href=#org-coderef--8846f0-14>14</a>
</span><span class=lnt id=org-coderef--8846f0-15><a class=lnlinks href=#org-coderef--8846f0-15>15</a>
</span><span class=lnt id=org-coderef--8846f0-16><a class=lnlinks href=#org-coderef--8846f0-16>16</a>
</span><span class=lnt id=org-coderef--8846f0-17><a class=lnlinks href=#org-coderef--8846f0-17>17</a>
</span><span class=lnt id=org-coderef--8846f0-18><a class=lnlinks href=#org-coderef--8846f0-18>18</a>
</span><span class=lnt id=org-coderef--8846f0-19><a class=lnlinks href=#org-coderef--8846f0-19>19</a>
</span><span class=lnt id=org-coderef--8846f0-20><a class=lnlinks href=#org-coderef--8846f0-20>20</a>
</span><span class=lnt id=org-coderef--8846f0-21><a class=lnlinks href=#org-coderef--8846f0-21>21</a>
</span><span class=lnt id=org-coderef--8846f0-22><a class=lnlinks href=#org-coderef--8846f0-22>22</a>
</span><span class=lnt id=org-coderef--8846f0-23><a class=lnlinks href=#org-coderef--8846f0-23>23</a>
</span><span class=lnt id=org-coderef--8846f0-24><a class=lnlinks href=#org-coderef--8846f0-24>24</a>
</span><span class=lnt id=org-coderef--8846f0-25><a class=lnlinks href=#org-coderef--8846f0-25>25</a>
</span><span class=lnt id=org-coderef--8846f0-26><a class=lnlinks href=#org-coderef--8846f0-26>26</a>
</span><span class=lnt id=org-coderef--8846f0-27><a class=lnlinks href=#org-coderef--8846f0-27>27</a>
</span><span class=lnt id=org-coderef--8846f0-28><a class=lnlinks href=#org-coderef--8846f0-28>28</a>
</span><span class=lnt id=org-coderef--8846f0-29><a class=lnlinks href=#org-coderef--8846f0-29>29</a>
</span><span class=lnt id=org-coderef--8846f0-30><a class=lnlinks href=#org-coderef--8846f0-30>30</a>
</span><span class=lnt id=org-coderef--8846f0-31><a class=lnlinks href=#org-coderef--8846f0-31>31</a>
</span><span class=lnt id=org-coderef--8846f0-32><a class=lnlinks href=#org-coderef--8846f0-32>32</a>
</span><span class=lnt id=org-coderef--8846f0-33><a class=lnlinks href=#org-coderef--8846f0-33>33</a>
</span><span class=lnt id=org-coderef--8846f0-34><a class=lnlinks href=#org-coderef--8846f0-34>34</a>
</span><span class=lnt id=org-coderef--8846f0-35><a class=lnlinks href=#org-coderef--8846f0-35>35</a>
</span><span class=lnt id=org-coderef--8846f0-36><a class=lnlinks href=#org-coderef--8846f0-36>36</a>
</span><span class=lnt id=org-coderef--8846f0-37><a class=lnlinks href=#org-coderef--8846f0-37>37</a>
</span><span class=lnt id=org-coderef--8846f0-38><a class=lnlinks href=#org-coderef--8846f0-38>38</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>action</span><span class=p>(</span><span class=n>elem</span><span class=p>,</span> <span class=n>doc</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>elem</span><span class=p>,</span> <span class=n>RawBlock</span><span class=p>)</span> <span class=ow>and</span> <span class=n>elem</span><span class=o>.</span><span class=n>format</span> <span class=o>==</span> <span class=s1>&#39;org&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=c1># Filter for Org Block to reassemble into proper metadata</span>
</span></span><span class=line><span class=cl>            <span class=c1># Not a fan of how I did this, but it works</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>elem</span><span class=o>.</span><span class=n>prev</span> <span class=o>==</span> <span class=kc>None</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=nb>list</span><span class=p>(</span><span class=n>elem</span><span class=o>.</span><span class=n>container</span><span class=p>))):</span>
</span></span><span class=line><span class=cl>                    <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>elem</span><span class=o>.</span><span class=n>offset</span><span class=p>(</span><span class=n>i</span><span class=p>),</span> <span class=n>RawBlock</span><span class=p>):</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                        <span class=n>header</span> <span class=o>=</span> <span class=n>metadata_parser</span><span class=p>(</span><span class=n>elem</span><span class=o>.</span><span class=n>offset</span><span class=p>(</span><span class=n>i</span><span class=p>),</span> <span class=n>doc</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                        <span class=n>doc</span><span class=o>.</span><span class=n>header</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>header</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                    <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                        <span class=k>break</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=n>Para</span><span class=p>(</span><span class=o>*</span><span class=p>[</span><span class=n>Str</span><span class=p>(</span><span class=n>i</span><span class=p>)</span> <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=n>doc</span><span class=o>.</span><span class=n>header</span><span class=p>])</span>
</span></span><span class=line><span class=cl>            <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>elif</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>elem</span><span class=p>,</span> <span class=n>Link</span><span class=p>)</span> <span class=ow>and</span> <span class=n>elem</span><span class=o>.</span><span class=n>url</span><span class=o>.</span><span class=n>startswith</span><span class=p>(</span><span class=s2>&#34;id:&#34;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=n>sanitize_link</span><span class=p>(</span><span class=n>elem</span><span class=p>,</span> <span class=n>doc</span><span class=p>)</span> <span class=c1>#                                     (sanitize2)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>elif</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>elem</span><span class=p>,</span> <span class=n>Header</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=n>level_string</span> <span class=o>=</span> <span class=n>header_parser</span><span class=p>(</span><span class=n>elem</span><span class=p>,</span> <span class=n>doc</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>Para</span><span class=p>(</span><span class=n>RawInline</span><span class=p>(</span><span class=n>level_string</span> <span class=o>+</span> <span class=n>stringify</span><span class=p>(</span><span class=n>elem</span><span class=p>)))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=kc>None</span> <span class=c1>#a none action                                     (none action)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>finalize</span><span class=p>(</span><span class=n>doc</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>pass</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>main</span><span class=p>(</span><span class=n>doc</span><span class=o>=</span><span class=kc>None</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>run_filter</span><span class=p>(</span><span class=n>action</span><span class=p>,</span> <span class=n>prepare</span><span class=p>,</span> <span class=n>finalize</span><span class=p>,</span> <span class=n>doc</span><span class=o>=</span><span class=n>doc</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&#34;__main__&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>db</span> <span class=o>=</span> <span class=n>sqlite3</span><span class=o>.</span><span class=n>connect</span><span class=p>(</span><span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>abspath</span><span class=p>(</span><span class=n>ORG_ROAM_DB_PATH</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>main</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><p>This is the meat n&rsquo; potatos of the code, so to speak. The run_filter takes an
&ldquo;action&rdquo; and goes down the AST provided by pandoc, using the rules associated
with the input/output format and the additional filter.</p><p>I basically:</p><ul><li>Look up the first element, make sure there&rsquo;s nothing behind that, then use
-that- to loop over the entire element container, stopping when there&rsquo;s no more RawBlocks.</li><li>I then parse the contents and add it to the header list. This then uses a list
comprehension to toss into a Paragraph using newlines to put them at the top like in the tiddlywiki example.</li><li>This then replaces each link type it encounters that starts with id:</li><li>Finally, it takes the extraneous header information and prepend&rsquo;s a !
depending on the header level.</li></ul><p>Most of my time was wasting understanding the Panflute API and how it interacted
with Pandoc. For example, I didn&rsquo;t realize at first to persist the data you
needed to essentially use the prepare functon and the doc class. And you need to
do modify/delete in the action function. (A <a href=#org-coderef--8846f0-26>none action</a> preserves an element and an empty
list [] performs a <a href=#org-coderef--e1bcfb-8>delete action</a>.)</p><p>Then we can finally do something like:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>pandoc test.org -t mediawiki -f org -F main.py -o test.tid
</span></span></code></pre></div><p>and wrap it in a shell script to work on certain org-files.</p><p>I probably made this a bit harder on myself by not simply using the Lua filters,
but it was fun to learn something new and now I can programatically export my
org-roam files to TiddlyWiki. I won&rsquo;t be able to do as much fancy HTML as I&rsquo;d
like without writing more filters, but I figure it&rsquo;s good enough to get me to
start writing more notes.</p></div><footer class=post-footer><nav class=paginav><a class=prev href=https://justin.vc/posts/reminder-check-doom-defaults-agenda/><span class=title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-left" style="user-select:text"><line x1="19" y1="12" x2="5" y2="12" style="user-select:text"/><polyline points="12 19 5 12 12 5" style="user-select:text"/></svg>&nbsp;Prev Page</span><br><span>A Reminder to Check on Doom Defaults: Org-Agenda</span>
</a><a class=next href=https://justin.vc/posts/literate-kedro-spaceflight/><span class=title>Next Page&nbsp;<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right" style="user-select:text"><line x1="5" y1="12" x2="19" y2="12" style="user-select:text"/><polyline points="12 5 19 12 12 19" style="user-select:text"/></svg></span><br><span>Literate Kedro: Using Org-mode for Data Science</span></a></nav></footer><script src=https://giscus.app/client.js data-repo=brickfrog/justin.vc data-repo-id=R_kgDOHssjcQ data-category=General data-category-id=DIC_kwDOHssjcc4CgLxH data-mapping=pathname data-strict=0 data-reactions-enabled=0 data-emit-metadata=0 data-input-position=bottom data-theme=https://justin.vc/themes/theme.css data-lang=en crossorigin=anonymous async></script></article></main><footer class=footer><span>&copy; 2021-2024 <a href=https://justin.vc/>justin.vc</a></span>,<span style=display:inline-block;margin-left:.5em>
<a href=https://creativecommons.org/licenses/by-sa/4.0/>CC BY-SA</a>
</span><span style=display:inline-block;margin-left:.25em>✯</span>
Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a>
<a href=https://github.com/brickfrog/hugo-PaperModulo/ rel=noopener target=_blank>(PaperModulo)</a>,
<a href=https://orgmode.org rel="noopener noreferrer" target=_blank>Org Mode</a>,
<a href=https://www.gnu.org/software/emacs rel=noopener target=_blank>GNU Emacs</a>, and
<a href=https://justin.vc/about/#this-site>others</a>.
</span><span style=display:inline-block;margin-left:.25em>✯</span>
<a href=https://justin.vc//index.xml>RSS</a></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>(function(){let e=document.getElementById("menu");e&&(e.scrollLeft=localStorage.getItem("menu-scroll-position"),e.onscroll=function(){localStorage.setItem("menu-scroll-position",e.scrollLeft)});const t=""=="1",n=""=="1";if(window.matchMedia("(prefers-reduced-motion: reduce)").matches||t||n)return;document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})})()</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>if(window.scrollListeners)for(const e of scrollListeners)window.removeEventListener("scroll",e);window.scrollListeners=[]</script><script src=/js/medium-zoom.min.js data-no-instant></script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerText="copy";function s(){t.innerText="copied!",setTimeout(()=>{t.innerText="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script><script>(function(){const a="1"=="1";if(!a)return;if(!document.querySelector(".toc")){console.log("no toc found, ignore toc scroll");return}const r=window.scrollListeners,t=document.querySelectorAll("h1[id],h2[id],h3[id],h4[id],h5[id]"),n="active";let e=t[0];o(e).classList.add(n);const c=()=>{const s=[];for(const e of t)if(l(e)<5)s.push(e);else break;s.length>0?newActiveHeading=s[s.length-1]:newActiveHeading=t[0],e!=newActiveHeading&&(o(e).classList.remove(n),e=newActiveHeading,o(e).classList.add(n))};let s=null;const i=()=>{s!==null&&clearTimeout(s),s=setTimeout(c,50)};window.addEventListener("scroll",i,!1),r.push(i);function o(e){const t=encodeURI(e.getAttribute("id")).toLowerCase();return document.querySelector(`.toc ul li a[href="#${t}"]`)}function l(e){if(!e.getClientRects().length)return 0;let t=e.getBoundingClientRect();return t.top}})()</script></body></html>